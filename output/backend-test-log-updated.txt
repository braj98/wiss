
> mycalapp-backend@1.0.0 test
> vitest


 DEV  v1.6.1 /home/shreyasee/Documents/wissen/wiss/backend

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should successfully fetch holidays
[ExternalHolidayApiClient] Fetching holidays for US 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Successfully fetched 0 holidays

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should handle empty response
[ExternalHolidayApiClient] Fetching holidays for US 2025-2
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=2
[ExternalHolidayApiClient] Successfully fetched 0 holidays

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should handle missing response object
[ExternalHolidayApiClient] Fetching holidays for US 2025-3
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=3
[ExternalHolidayApiClient] Successfully fetched 0 holidays

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should truncate long holiday names
[ExternalHolidayApiClient] Fetching holidays for US 2025-12
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=12
[ExternalHolidayApiClient] Successfully fetched 0 holidays

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should not retry on 400 error
[ExternalHolidayApiClient] Fetching holidays for INVALID 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=INVALID&year=2025&month=1
[ExternalHolidayApiClient] Not retrying (attempt 1): HTTP 400

stderr | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should not retry on 400 error
[ExternalHolidayApiClient] API call failed: Bad Request
[ExternalHolidayApiClient] Failed to fetch holidays: ApiError: HTTP 400
    at ExternalHolidayApiClient.callExternalApi (/home/shreyasee/Documents/wissen/wiss/backend/src/services/ExternalHolidayApiClient.ts:93:17)
    at ExternalHolidayApiClient.fetchWithRetry (/home/shreyasee/Documents/wissen/wiss/backend/src/services/ExternalHolidayApiClient.ts:154:14)
    at ExternalHolidayApiClient.fetchHolidays (/home/shreyasee/Documents/wissen/wiss/backend/src/services/ExternalHolidayApiClient.ts:46:24)
    at /home/shreyasee/Documents/wissen/wiss/backend/src/__tests__/services/ExternalHolidayApiClient.test.ts:122:9
    at runTest (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:967:3) {
  statusCode: 400,
  isRetryable: false
}

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should not retry on 401 error
[ExternalHolidayApiClient] Fetching holidays for US 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Not retrying (attempt 1): HTTP 401

stderr | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should not retry on 401 error
[ExternalHolidayApiClient] API call failed: Unauthorized
[ExternalHolidayApiClient] Failed to fetch holidays: ApiError: HTTP 401
    at ExternalHolidayApiClient.callExternalApi (/home/shreyasee/Documents/wissen/wiss/backend/src/services/ExternalHolidayApiClient.ts:93:17)
    at ExternalHolidayApiClient.fetchWithRetry (/home/shreyasee/Documents/wissen/wiss/backend/src/services/ExternalHolidayApiClient.ts:154:14)
    at ExternalHolidayApiClient.fetchHolidays (/home/shreyasee/Documents/wissen/wiss/backend/src/services/ExternalHolidayApiClient.ts:46:24)
    at /home/shreyasee/Documents/wissen/wiss/backend/src/__tests__/services/ExternalHolidayApiClient.test.ts:139:9
    at runTest (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:967:3) {
  statusCode: 401,
  isRetryable: false
}

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should not retry on 404 error
[ExternalHolidayApiClient] Fetching holidays for XX 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=XX&year=2025&month=1
[ExternalHolidayApiClient] Not retrying (attempt 1): HTTP 404

stderr | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should not retry on 404 error
[ExternalHolidayApiClient] API call failed: Not Found
[ExternalHolidayApiClient] Failed to fetch holidays: ApiError: HTTP 404
    at ExternalHolidayApiClient.callExternalApi (/home/shreyasee/Documents/wissen/wiss/backend/src/services/ExternalHolidayApiClient.ts:93:17)
    at ExternalHolidayApiClient.fetchWithRetry (/home/shreyasee/Documents/wissen/wiss/backend/src/services/ExternalHolidayApiClient.ts:154:14)
    at ExternalHolidayApiClient.fetchHolidays (/home/shreyasee/Documents/wissen/wiss/backend/src/services/ExternalHolidayApiClient.ts:46:24)
    at /home/shreyasee/Documents/wissen/wiss/backend/src/__tests__/services/ExternalHolidayApiClient.test.ts:155:9
    at runTest (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///home/shreyasee/Documents/wissen/wiss/backend/node_modules/@vitest/runner/dist/index.js:967:3) {
  statusCode: 404,
  isRetryable: false
}

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should categorize national holidays correctly
[ExternalHolidayApiClient] Fetching holidays for US 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Successfully fetched 0 holidays

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should categorize observance holidays correctly
[ExternalHolidayApiClient] Fetching holidays for US 2025-3
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=3
[ExternalHolidayApiClient] Successfully fetched 0 holidays

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should handle multiple holidays in response
[ExternalHolidayApiClient] Fetching holidays for US 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Successfully fetched 0 holidays

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should include API key from environment
[ExternalHolidayApiClient] Fetching holidays for US 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Successfully fetched 0 holidays

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should use demo key when no API key provided
[ExternalHolidayApiClient] Fetching holidays for US 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Successfully fetched 0 holidays

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should throw error on network failure
[ExternalHolidayApiClient] Fetching holidays for US 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Retrying in 1000ms (attempt 1/4)

stderr | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should throw error on network failure
[ExternalHolidayApiClient] API call failed: Network failed

stdout | new HolidayDataProvider (/home/shreyasee/Documents/wissen/wiss/backend/src/services/HolidayDataProvider.ts:109:13)
[HolidayDataProvider] Using source: file

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return work holidays for valid year and month
GET /api/work-holidays
[WorkHolidayService] Getting holidays for 2025-3
[WorkHolidayService] Found 0 work holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should filter by department
GET /api/work-holidays
[WorkHolidayService] Getting holidays for 2025-4, dept: engineering
[WorkHolidayService] Found 0 work holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for missing year
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for invalid year
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for year out of range
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for missing month
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for invalid month
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for month out of range
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-date > should return work holidays for specific date
GET /api/work-holidays/by-date
[WorkHolidayService] Found 0 holidays in range 2025-03-15 to 2025-03-15

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-date > should filter by department for specific date
GET /api/work-holidays/by-date
[WorkHolidayService] Found 0 holidays in range 2025-04-01 to 2025-04-01

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-date > should return 400 for missing date
GET /api/work-holidays/by-date

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-date > should return 400 for invalid date format
GET /api/work-holidays/by-date

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-range > should return work holidays for date range
GET /api/work-holidays/by-range
[WorkHolidayService] Getting holidays for 2025, months: 1, 2, 3
[WorkHolidayService] Getting holidays for 2025-1
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-2
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-3
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Found holidays for 3 months

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-range > should filter by department for date range
GET /api/work-holidays/by-range
[WorkHolidayService] Getting holidays for 2025, months: 1, 2, 3, 4, 5, 6, dept: sales
[WorkHolidayService] Getting holidays for 2025-1, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-2, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-3, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-4, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-5, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-6, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Found holidays for 6 months

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-range > should return 400 for invalid month range
GET /api/work-holidays/by-range

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/departments > should return list of all departments
GET /api/work-holidays/departments

 â¯ src/__tests__/api/workHolidays.api.test.ts  (16 tests | 1 failed) 76ms
   â¯ src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-range > should return work holidays for date range
     â†’ expected { '2025-01': [], '2025-02': [], â€¦(1) } to be an instance of Array
 âœ“ src/__tests__/services/CacheStore.test.ts  (19 tests) 10ms
 â¯ src/__tests__/services/WorkHolidayService.test.ts  (12 tests | 1 failed) 15ms
   â¯ src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidaysForMonth > should include company-wide holidays regardless of department
     â†’ expected false to be true // Object.is equality
stdout | src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidaysForMonth > should return holidays for specific month
[WorkHolidayService] Getting holidays for 2025-9
[WorkHolidayService] Found 3 work holidays

stdout | src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidaysForMonth > should filter by department
[WorkHolidayService] Getting holidays for 2025-7, dept: Engineering
[WorkHolidayService] Found 0 work holidays

stdout | src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidaysForMonth > should return empty array for month with no holidays
[WorkHolidayService] Getting holidays for 2025-2
[WorkHolidayService] Found 0 work holidays

stdout | src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidaysForMonth > should include company-wide holidays regardless of department
[WorkHolidayService] Getting holidays for 2025-7, dept: Engineering
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-7, dept: Sales
[WorkHolidayService] Found 0 work holidays

stdout | src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidaysInRange > should return holidays for date range
[WorkHolidayService] Found 11 holidays in range 2025-09-01 to 2025-12-31

stdout | src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidaysInRange > should filter by department for range
[WorkHolidayService] Found 5 holidays in range 2025-01-01 to 2025-12-31

stdout | src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidaysByDepartment > should return specific department holidays
[WorkHolidayService] Found 27 holidays for department Engineering

stdout | src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidayById > should return holiday by ID
[WorkHolidayService] Found holiday by ID work_2025_09_001: yes

stdout | src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidayById > should return null for non-existent ID
[WorkHolidayService] Found holiday by ID nonexistent: no

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should throw error on network failure
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Retrying in 2000ms (attempt 2/4)

stderr | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should throw error on network failure
[ExternalHolidayApiClient] API call failed: Network failed

stdout | new HolidayDataProvider (/home/shreyasee/Documents/wissen/wiss/backend/src/services/HolidayDataProvider.ts:109:13)
[HolidayDataProvider] Using source: file

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /api/holidays > should return 400 for invalid country format
GET /api/holidays

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /api/holidays > should return 400 for invalid year
GET /api/holidays

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /api/holidays > should return 400 for missing country
GET /api/holidays

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /api/holidays > should return 400 for invalid country code length
GET /api/holidays

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /api/holidays > should return 400 for missing year
GET /api/holidays

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /api/holidays > should return 400 for invalid year range
GET /api/holidays

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /api/holidays > should return 400 for missing month
GET /api/holidays

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /api/holidays > should return 400 for invalid month range
GET /api/holidays

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /health > should return health status
GET /health

stdout | src/__tests__/api/holidays.api.test.ts > API - /api/holidays > GET /unknown-route > should return 404 for unknown routes
GET /unknown-route

 âœ“ src/__tests__/api/holidays.api.test.ts  (10 tests) 64ms
stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should throw error on network failure
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Retrying in 4000ms (attempt 3/4)

stderr | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should throw error on network failure
[ExternalHolidayApiClient] API call failed: Network failed

stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should handle axios error responses
[ExternalHolidayApiClient] Fetching holidays for US 2025-1
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Retrying in 1000ms (attempt 1/4)

stderr | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should handle axios error responses
[ExternalHolidayApiClient] API call failed: Server error

stderr | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should handle axios error responses
<empty line>
stdout | src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should handle axios error responses
[ExternalHolidayApiClient] Calling API: https://api.holidayapi.com/v1/holidays?key=***&country=US&year=2025&month=1
[ExternalHolidayApiClient] Successfully fetched 0 holidays

 â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts  (14 tests | 8 failed) 6042ms
   â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should successfully fetch holidays
     â†’ expected [] to have a length of 1 but got +0
   â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should truncate long holiday names
     â†’ Cannot read properties of undefined (reading 'name')
   â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should categorize national holidays correctly
     â†’ expected undefined to match object { category: 'national', â€¦(1) }
   â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should categorize observance holidays correctly
     â†’ expected undefined to match object { category: 'observance', â€¦(1) }
   â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should handle multiple holidays in response
     â†’ expected [] to have a length of 2 but got +0
   â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should include API key from environment
     â†’ expected "wrap" to be called with arguments: [ Anything, ObjectContaining{â€¦} ]

Received: 

  1st wrap call:

  Array [
-   Anything,
-   ObjectContaining {
-     "params": ObjectContaining {
-       "key": "test-key-123",
+   "https://api.holidayapi.com/v1/holidays?key=test-key-123&country=US&year=2025&month=1",
+   Object {
+     "headers": Object {
+       "User-Agent": "MyCalApp/1.0",
      },
+     "timeout": 5000,
    },
  ]


Number of calls: 1

   â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should use demo key when no API key provided
     â†’ expected "wrap" to be called with arguments: [ Anything, ObjectContaining{â€¦} ]

Received: 

  1st wrap call:

  Array [
-   Anything,
-   ObjectContaining {
-     "params": ObjectContaining {
-       "key": "demo",
+   "https://api.holidayapi.com/v1/holidays?key=demo&country=US&year=2025&month=1",
+   Object {
+     "headers": Object {
+       "User-Agent": "MyCalApp/1.0",
      },
+     "timeout": 5000,
    },
  ]


Number of calls: 1

   â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should throw error on network failure
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 10 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-range > should return work holidays for date range
AssertionError: expected { '2025-01': [], '2025-02': [], â€¦(1) } to be an instance of Array
 â¯ src/__tests__/api/workHolidays.api.test.ts:149:29
    147| 
    148|       expect(res.status).toBe(200);
    149|       expect(res.body.data).toBeInstanceOf(Array);
       |                             ^
    150|       expect(res.body.meta.startMonth).toBe(1);
    151|       expect(res.body.meta.endMonth).toBe(3);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/10]âŽ¯

 FAIL  src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should successfully fetch holidays
AssertionError: expected [] to have a length of 1 but got +0

- Expected
+ Received

- 1
+ 0

 â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts:53:22
     51|       const result = await client.fetchHolidays('US', 2025, 1);
     52| 
     53|       expect(result).toHaveLength(1);
       |                      ^
     54|       expect(result[0]).toMatchObject({
     55|         name: "New Year's Day",

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/10]âŽ¯

 FAIL  src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should truncate long holiday names
TypeError: Cannot read properties of undefined (reading 'name')
 â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts:111:24
    109|       const result = await client.fetchHolidays('US', 2025, 12);
    110| 
    111|       expect(result[0].name).toHaveLength(200);
       |                        ^
    112|     });
    113| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/10]âŽ¯

 FAIL  src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should categorize national holidays correctly
AssertionError: expected undefined to match object { category: 'national', â€¦(1) }

- Expected: 
Object {
  "category": "national",
  "isPublicHoliday": true,
}

+ Received: 
undefined

 â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts:181:25
    179|       const result = await client.fetchHolidays('US', 2025, 1);
    180| 
    181|       expect(result[0]).toMatchObject({
       |                         ^
    182|         category: 'national',
    183|         isPublicHoliday: true

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/10]âŽ¯

 FAIL  src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should categorize observance holidays correctly
AssertionError: expected undefined to match object { category: 'observance', â€¦(1) }

- Expected: 
Object {
  "category": "observance",
  "isPublicHoliday": false,
}

+ Received: 
undefined

 â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts:205:25
    203|       const result = await client.fetchHolidays('US', 2025, 3);
    204| 
    205|       expect(result[0]).toMatchObject({
       |                         ^
    206|         category: 'observance',
    207|         isPublicHoliday: false

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/10]âŽ¯

 FAIL  src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should handle multiple holidays in response
AssertionError: expected [] to have a length of 2 but got +0

- Expected
+ Received

- 2
+ 0

 â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts:234:22
    232|       const result = await client.fetchHolidays('US', 2025, 1);
    233| 
    234|       expect(result).toHaveLength(2);
       |                      ^
    235|       expect(result.every(h => h.country === 'US')).toBe(true);
    236|       expect(result.map(h => h.name)).toContain("New Year's Day");

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/10]âŽ¯

 FAIL  src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should include API key from environment
AssertionError: expected "wrap" to be called with arguments: [ Anything, ObjectContaining{â€¦} ]

Received: 

  1st wrap call:

  Array [
-   Anything,
-   ObjectContaining {
-     "params": ObjectContaining {
-       "key": "test-key-123",
+   "https://api.holidayapi.com/v1/holidays?key=test-key-123&country=US&year=2025&month=1",
+   Object {
+     "headers": Object {
+       "User-Agent": "MyCalApp/1.0",
      },
+     "timeout": 5000,
    },
  ]


Number of calls: 1

 â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts:255:31
    253|       await client.fetchHolidays('US', 2025, 1);
    254| 
    255|       expect(mockedAxios.get).toHaveBeenCalledWith(
       |                               ^
    256|         expect.anything(),
    257|         expect.objectContaining({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/10]âŽ¯

 FAIL  src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > fetchHolidays > should use demo key when no API key provided
AssertionError: expected "wrap" to be called with arguments: [ Anything, ObjectContaining{â€¦} ]

Received: 

  1st wrap call:

  Array [
-   Anything,
-   ObjectContaining {
-     "params": ObjectContaining {
-       "key": "demo",
+   "https://api.holidayapi.com/v1/holidays?key=demo&country=US&year=2025&month=1",
+   Object {
+     "headers": Object {
+       "User-Agent": "MyCalApp/1.0",
      },
+     "timeout": 5000,
    },
  ]


Number of calls: 1

 â¯ src/__tests__/services/ExternalHolidayApiClient.test.ts:282:31
    280|       await client.fetchHolidays('US', 2025, 1);
    281| 
    282|       expect(mockedAxios.get).toHaveBeenCalledWith(
       |                               ^
    283|         expect.anything(),
    284|         expect.objectContaining({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/10]âŽ¯

 FAIL  src/__tests__/services/ExternalHolidayApiClient.test.ts > ExternalHolidayApiClient > Error handling > should throw error on network failure
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/10]âŽ¯

 FAIL  src/__tests__/services/WorkHolidayService.test.ts > WorkHolidayService > getHolidaysForMonth > should include company-wide holidays regardless of department
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ src/__tests__/services/WorkHolidayService.test.ts:49:35
     47|       const hasBreakSales = salesHolidays.some((h: any) => h.name === â€¦
     48| 
     49|       expect(hasBreakEngineering).toBe(true);
       |                                   ^
     50|       expect(hasBreakSales).toBe(true);
     51|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/10]âŽ¯

 Test Files  3 failed | 2 passed (5)
      Tests  10 failed | 61 passed (71)
   Start at  00:16:01
   Duration  6.67s (transform 227ms, setup 0ms, collect 805ms, tests 6.21s, environment 1ms, prepare 525ms)


 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
[3Jc
 RERUN  src/__tests__/api/workHolidays.api.test.ts x1

stdout | new HolidayDataProvider (/home/shreyasee/Documents/wissen/wiss/backend/src/services/HolidayDataProvider.ts:109:13)
[HolidayDataProvider] Using source: file

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return work holidays for valid year and month
GET /api/work-holidays
[WorkHolidayService] Getting holidays for 2025-3
[WorkHolidayService] Found 0 work holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should filter by department
GET /api/work-holidays
[WorkHolidayService] Getting holidays for 2025-4, dept: engineering
[WorkHolidayService] Found 0 work holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for missing year
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for invalid year
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for year out of range
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for missing month
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for invalid month
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays > should return 400 for month out of range
GET /api/work-holidays

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-date > should return work holidays for specific date
GET /api/work-holidays/by-date
[WorkHolidayService] Found 0 holidays in range 2025-03-15 to 2025-03-15

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-date > should filter by department for specific date
GET /api/work-holidays/by-date
[WorkHolidayService] Found 0 holidays in range 2025-04-01 to 2025-04-01

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-date > should return 400 for missing date
GET /api/work-holidays/by-date

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-date > should return 400 for invalid date format
GET /api/work-holidays/by-date

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-range > should return work holidays for date range
GET /api/work-holidays/by-range
[WorkHolidayService] Getting holidays for 2025, months: 1, 2, 3
[WorkHolidayService] Getting holidays for 2025-1
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-2
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-3
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Found holidays for 3 months

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-range > should filter by department for date range
GET /api/work-holidays/by-range
[WorkHolidayService] Getting holidays for 2025, months: 1, 2, 3, 4, 5, 6, dept: sales
[WorkHolidayService] Getting holidays for 2025-1, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-2, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-3, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-4, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-5, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Getting holidays for 2025-6, dept: sales
[WorkHolidayService] Found 0 work holidays
[WorkHolidayService] Found holidays for 6 months

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/by-range > should return 400 for invalid month range
GET /api/work-holidays/by-range

stdout | src/__tests__/api/workHolidays.api.test.ts > API - /api/work-holidays > GET /api/work-holidays/departments > should return list of all departments
GET /api/work-holidays/departments

 âœ“ src/__tests__/api/workHolidays.api.test.ts  (16 tests) 143ms

 Test Files  1 passed (1)
      Tests  16 passed (16)
   Start at  00:17:51
   Duration  883ms


 PASS  Waiting for file changes...
       press h to show help, press q to quit
       rerun x1
[2K[1A[2K[G